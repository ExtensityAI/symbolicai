
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>symai.components &#8212; SymbolicAI</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../../_static/documentation_options.js?v=df347da4"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/symai/components';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="version" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../index.html">
  
  
  
  
  
  
    <p class="title logo__title">SymbolicAI</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../INTRODUCTION.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../INSTALLATION.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../QUICKSTART.html">Quick Start Guide</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../FEATURES/index.html">Features</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../FEATURES/causal_reasoning.html">üß† Causal Reasoning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FEATURES/operations.html">Operations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FEATURES/expressions.html">Expressions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FEATURES/vision.html">Vision</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FEATURES/import.html">Module Management</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../FEATURES/error_handling.html">‚ùå Error Handling and Debugging</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../ENGINES/index.html">Engines</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/neurosymbolic_engine.html">Neuro-Symbolic Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/symbolic_engine.html">Symbolic Engine (WolframAlpha)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/speech_engine.html">Speech Engine (Whisper)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/ocr_engine.html">OCR Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/search_engine.html">Search Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/webcrawler_engine.html">Webcrawler Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/drawing_engine.html">Drawing Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/file_engine.html">File Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/indexing_engine.html">Indexing Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/clip_engine.html">CLIP Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/local_engine.html">Local Engines</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../ENGINES/custom_engine.html">Custom Engine</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TUTORIALS/index.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../TUTORIALS/chatbot.html">Writing a Custom Chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TUTORIALS/data_query.html">Querying Data with SQL</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TUTORIALS/context.html">Handling Files and Long Context Lengths</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TUTORIALS/video_tutorials.html">Video Tutorials</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TUTORIALS/examples.html">Example Files</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../TOOLS/index.html">Tools</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../TOOLS/shell.html">Shell Command Tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TOOLS/chatbot.html">Chatbot</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../TOOLS/packages.html">Packages</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../API_REF.html">API Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../symai.html">symai package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../symai.backend.html">symai.backend package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../symai.backend.engines.html">symai.backend.engines package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.backend.mixin.html">symai.backend.mixin package</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.collect.html">symai.collect package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../symai.extended.html">symai.extended package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.interfaces.html">symai.extended.interfaces package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.metrics.html">symai.extended.metrics package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.packages.html">symai.extended.packages package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.personas.html">symai.extended.personas package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.strategies.html">symai.extended.strategies package</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.formatter.html">symai.formatter package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.menu.html">symai.menu package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.misc.html">symai.misc package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.models.html">symai.models package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.ops.html">symai.ops package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.server.html">symai.server package</a></li>
</ul>
</details></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../symai.backend.html">symai.backend package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../symai.backend.engines.html">symai.backend.engines package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.backend.mixin.html">symai.backend.mixin package</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.backend.engines.html">symai.backend.engines package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.backend.mixin.html">symai.backend.mixin package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.collect.html">symai.collect package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../symai.extended.html">symai.extended package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.interfaces.html">symai.extended.interfaces package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.metrics.html">symai.extended.metrics package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.packages.html">symai.extended.packages package</a></li>
<li class="toctree-l3 has-children"><a class="reference internal" href="../../symai.extended.personas.html">symai.extended.personas package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.personas.research.html">symai.extended.personas.research package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.personas.sales.html">symai.extended.personas.sales package</a></li>
<li class="toctree-l4"><a class="reference internal" href="../../symai.extended.personas.student.html">symai.extended.personas.student package</a></li>
</ul>
</details></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.strategies.html">symai.extended.strategies package</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.interfaces.html">symai.extended.interfaces package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.metrics.html">symai.extended.metrics package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.packages.html">symai.extended.packages package</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../../symai.extended.personas.html">symai.extended.personas package</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.personas.research.html">symai.extended.personas.research package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.personas.sales.html">symai.extended.personas.sales package</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../symai.extended.personas.student.html">symai.extended.personas.student package</a></li>
</ul>
</details></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.personas.research.html">symai.extended.personas.research package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.personas.sales.html">symai.extended.personas.sales package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.personas.student.html">symai.extended.personas.student package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.extended.strategies.html">symai.extended.strategies package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.formatter.html">symai.formatter package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.menu.html">symai.menu package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.misc.html">symai.misc package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.models.html">symai.models package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.ops.html">symai.ops package</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../symai.server.html">symai.server package</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../CONTRIBUTING.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../LICENSE.html">License</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item"><nav class="sidebar-indices-items" aria-labelledby="pst-indices-navigation-heading-2">
  <p id="pst-indices-navigation-heading-2" class="sidebar-indices-items__title" role="heading" aria-level="1">Indices</p>
  <ul class="indices-link">
        <li class="toctree-l1">
          <a class="reference internal"
             href="../../genindex.html"
             accesskey="I">General Index</a>
        </li>
        <li class="toctree-l1">
          <a class="reference internal" href="../../py-modindex.html">Python Module Index</a>
        </li>
  </ul>
</nav></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/ExtensityAI/symbolicai" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <h1>Source code for symai.components</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">copy</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inspect</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">abstractmethod</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">random</span><span class="w"> </span><span class="kn">import</span> <span class="n">sample</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">string</span><span class="w"> </span><span class="kn">import</span> <span class="n">ascii_lowercase</span><span class="p">,</span> <span class="n">ascii_uppercase</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">threading</span><span class="w"> </span><span class="kn">import</span> <span class="n">Lock</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Iterator</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">attr</span><span class="w"> </span><span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">box</span><span class="w"> </span><span class="kn">import</span> <span class="n">Box</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">loguru</span><span class="w"> </span><span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pydantic</span><span class="w"> </span><span class="kn">import</span> <span class="n">BaseModel</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pyvis.network</span><span class="w"> </span><span class="kn">import</span> <span class="n">Network</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tqdm</span><span class="w"> </span><span class="kn">import</span> <span class="n">tqdm</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">.</span><span class="w"> </span><span class="kn">import</span> <span class="n">core</span><span class="p">,</span> <span class="n">core_ext</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.backend.base</span><span class="w"> </span><span class="kn">import</span> <span class="n">Engine</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.backend.settings</span><span class="w"> </span><span class="kn">import</span> <span class="n">HOME_PATH</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.constraints</span><span class="w"> </span><span class="kn">import</span> <span class="n">DictFormatConstraint</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.formatter</span><span class="w"> </span><span class="kn">import</span> <span class="n">ParagraphFormatter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">LengthConstraint</span><span class="p">,</span> <span class="n">LLMDataModel</span><span class="p">,</span> <span class="n">TypeValidationError</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.post_processors</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span><span class="n">CodeExtractPostProcessor</span><span class="p">,</span>
                              <span class="n">JsonTruncateMarkdownPostProcessor</span><span class="p">,</span>
                              <span class="n">JsonTruncatePostProcessor</span><span class="p">,</span> <span class="n">PostProcessor</span><span class="p">,</span>
                              <span class="n">StripPostProcessor</span><span class="p">)</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.pre_processors</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonPreProcessor</span><span class="p">,</span> <span class="n">PreProcessor</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.processor</span><span class="w"> </span><span class="kn">import</span> <span class="n">ProcessorPipeline</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.prompts</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonPromptTemplate</span><span class="p">,</span> <span class="n">Prompt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.symbol</span><span class="w"> </span><span class="kn">import</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">Metadata</span><span class="p">,</span> <span class="n">Symbol</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">CustomUserWarning</span>


<div class="viewcode-block" id="GraphViz">
<a class="viewcode-back" href="../../symai.html#symai.components.GraphViz">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">GraphViz</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">notebook</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">cdn_resources</span> <span class="o">=</span> <span class="s2">&quot;remote&quot;</span><span class="p">,</span>
                 <span class="n">bgcolor</span> <span class="o">=</span> <span class="s2">&quot;#222222&quot;</span><span class="p">,</span>
                 <span class="n">font_color</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
                 <span class="n">height</span> <span class="o">=</span> <span class="s2">&quot;750px&quot;</span><span class="p">,</span>
                 <span class="n">width</span> <span class="o">=</span> <span class="s2">&quot;100%&quot;</span><span class="p">,</span>
                 <span class="n">select_menu</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="n">filter_menu</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span>  <span class="o">=</span> <span class="n">Network</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="n">notebook</span><span class="p">,</span>
                            <span class="n">cdn_resources</span><span class="o">=</span><span class="n">cdn_resources</span><span class="p">,</span>
                            <span class="n">bgcolor</span><span class="o">=</span><span class="n">bgcolor</span><span class="p">,</span>
                            <span class="n">font_color</span><span class="o">=</span><span class="n">font_color</span><span class="p">,</span>
                            <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span>
                            <span class="n">select_menu</span><span class="o">=</span><span class="n">select_menu</span><span class="p">,</span>
                            <span class="n">filter_menu</span><span class="o">=</span><span class="n">filter_menu</span><span class="p">)</span>

<div class="viewcode-block" id="GraphViz.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.GraphViz.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="n">n</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">nodes</span><span class="p">]</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="p">[(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                  <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="k">else</span> <span class="n">e</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="n">simplified</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">edges</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">add_nodes</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">add_edges</span><span class="p">(</span><span class="n">edges</span><span class="p">)</span>
        <span class="n">file_path</span> <span class="o">=</span> <span class="n">file_path</span> <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.html&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="n">file_path</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">net</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="TrackerTraceable">
<a class="viewcode-back" href="../../symai.html#symai.components.TrackerTraceable">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">TrackerTraceable</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">pass</span></div>



<div class="viewcode-block" id="Any">
<a class="viewcode-back" href="../../symai.html#symai.components.Any">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Any</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>

<div class="viewcode-block" id="Any.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Any.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_return_type</span><span class="p">(</span><span class="nb">any</span><span class="p">([</span><span class="n">e</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)]))</span></div>
</div>



<div class="viewcode-block" id="All">
<a class="viewcode-back" href="../../symai.html#symai.components.All">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">All</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>

<div class="viewcode-block" id="All.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.All.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_return_type</span><span class="p">(</span><span class="nb">all</span><span class="p">([</span><span class="n">e</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)]))</span></div>
</div>



<div class="viewcode-block" id="Try">
<a class="viewcode-back" href="../../symai.html#symai.components.Try">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Try</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">retries</span>

<div class="viewcode-block" id="Try.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Try.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">ftry</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">retries</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Lambda">
<a class="viewcode-back" href="../../symai.html#symai.components.Lambda">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Lambda</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">callable</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_callable</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;args&#39;</span><span class="p">:</span> <span class="n">args</span><span class="p">,</span>
                <span class="s1">&#39;kwargs&#39;</span><span class="p">:</span> <span class="n">kwargs</span><span class="p">,</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nb">callable</span><span class="p">(</span><span class="n">kw</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callable</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">_callable</span>

<div class="viewcode-block" id="Lambda.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Lambda.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">callable</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Choice">
<a class="viewcode-back" href="../../symai.html#symai.components.Choice">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Choice</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">cases</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">default</span>

<div class="viewcode-block" id="Choice.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Choice.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">cases</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">cases</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Output">
<a class="viewcode-back" href="../../symai.html#symai.components.Output">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Output</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span><span class="p">,</span> <span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handler</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">handler</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="Output.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Output.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;verbose&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;handler&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Sequence">
<a class="viewcode-back" href="../../symai.html#symai.components.Sequence">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Sequence</span><span class="p">(</span><span class="n">TrackerTraceable</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">expressions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">expressions</span>

<div class="viewcode-block" id="Sequence.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Sequence.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">metadata</span> <span class="o">=</span> <span class="n">Metadata</span><span class="p">()</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">metadata</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">expr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expressions</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="n">sym</span> <span class="o">=</span> <span class="n">expr</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">sym</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">results</span>
        <span class="k">return</span> <span class="n">sym</span></div>
</div>



<div class="viewcode-block" id="Parallel">
<a class="viewcode-back" href="../../symai.html#symai.components.Parallel">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Parallel</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">],</span> <span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequential</span><span class="p">:</span> <span class="nb">bool</span>       <span class="o">=</span> <span class="n">sequential</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Symbol</span><span class="p">]</span>  <span class="o">=</span> <span class="p">[]</span>

<div class="viewcode-block" id="Parallel.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Parallel.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="c1"># run in sequence</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sequential</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[</span><span class="n">e</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">]</span>
        <span class="c1"># run in parallel</span>
        <span class="nd">@core_ext</span><span class="o">.</span><span class="n">parallel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">e</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results</span> <span class="o">=</span> <span class="n">_func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># final result of the parallel execution</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results</span><span class="p">)</span></div>
</div>



<span class="c1">#@TODO: BinPacker(format=&quot;...&quot;) -&gt; ensure that data packages form a &quot;bin&quot; that&#39;s consistent (e.g. never break a sentence in the middle)</span>
<div class="viewcode-block" id="Stream">
<a class="viewcode-back" href="../../symai.html#symai.components.Stream">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Stream</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">retrieval</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">char_token_ratio</span><span class="p">:</span>    <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span><span class="p">:</span>   <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">retrieval</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span><span class="p">:</span>               <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_frame</span>            <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Stream.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Stream.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Iterator</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span><span class="p">:</span>
            <span class="n">local_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_frame</span><span class="o">.</span><span class="n">f_locals</span>
            <span class="n">vals</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">local_vars</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">TrackerTraceable</span><span class="p">):</span>
                    <span class="n">vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;This component does either not inherit from TrackerTraceable or has an invalid number of component declarations: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="si">}</span><span class="s2">! Only one component that inherits from TrackerTraceable is allowed in the with stream clause.&quot;</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">stream</span><span class="p">(</span><span class="n">expr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">,</span>
                         <span class="n">char_token_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">char_token_ratio</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">==</span> <span class="s1">&#39;longest&#39;</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">==</span> <span class="s1">&#39;contains&#39;</span><span class="p">:</span>
                <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="ow">in</span> <span class="n">r</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">res</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid retrieval method: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_back</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">False</span></div>



<div class="viewcode-block" id="Trace">
<a class="viewcode-back" href="../../symai.html#symai.components.Trace">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Trace</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">engines</span>

<div class="viewcode-block" id="Trace.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Trace.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></div>



<div class="viewcode-block" id="Analyze">
<a class="viewcode-back" href="../../symai.html#symai.components.Analyze">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Analyze</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exception</span><span class="p">:</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">:</span> <span class="n">Expression</span> <span class="o">=</span> <span class="n">exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">query</span>

<div class="viewcode-block" id="Analyze.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Analyze.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">analyze</span><span class="p">(</span><span class="n">exception</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">exception</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Log">
<a class="viewcode-back" href="../../symai.html#symai.components.Log">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Log</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Expression</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;all&#39;</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">:</span> <span class="n">Expression</span> <span class="o">=</span> <span class="n">expr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">engines</span>

<div class="viewcode-block" id="Log.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Log.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">logging</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="fm">__enter__</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="n">Expression</span><span class="o">.</span><span class="n">command</span><span class="p">(</span><span class="n">logging</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">engines</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">engines</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">expr</span><span class="o">.</span><span class="fm">__exit__</span><span class="p">(</span><span class="nb">type</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">)</span></div>



<div class="viewcode-block" id="Template">
<a class="viewcode-back" href="../../symai.html#symai.components.Template">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Template</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&lt;html&gt;&lt;body&gt;{{placeholder}}&lt;/body&gt;&lt;/html&gt;&quot;</span><span class="p">,</span> <span class="n">placeholder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;{{placeholder}}&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span> <span class="o">=</span> <span class="n">placeholder</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template_</span> <span class="o">=</span> <span class="n">template</span>

<div class="viewcode-block" id="Template.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Template.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">template</span><span class="p">(</span><span class="n">template</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">template_</span><span class="p">,</span> <span class="n">placeholder</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">placeholder</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Extract">
<a class="viewcode-back" href="../../symai.html#symai.components.Extract">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Extract</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query</span> <span class="o">=</span> <span class="n">query</span>

<div class="viewcode-block" id="Extract.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Extract.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="RuntimeExpression">
<a class="viewcode-back" href="../../symai.html#symai.components.RuntimeExpression">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">RuntimeExpression</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="c1"># define function that executes expressions</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">runner</span> <span class="o">=</span> <span class="n">Execute</span><span class="p">(</span><span class="n">enclosure</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<div class="viewcode-block" id="RuntimeExpression.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.RuntimeExpression.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">):</span>
        <span class="n">code</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="c1"># declare the runtime expression from the code</span>
        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">runner</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">sym</span><span class="p">):</span>
            <span class="c1"># execute nested expression</span>
            <span class="k">return</span> <span class="n">expr</span><span class="p">[</span><span class="s1">&#39;locals&#39;</span><span class="p">][</span><span class="s1">&#39;_output_&#39;</span><span class="p">](</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">_func</span></div>
</div>



<div class="viewcode-block" id="Metric">
<a class="viewcode-back" href="../../symai.html#symai.components.Metric">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Metric</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">normalize</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span>  <span class="o">=</span> <span class="n">normalize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span>        <span class="o">=</span> <span class="n">eps</span>

<div class="viewcode-block" id="Metric.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Metric.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">assert</span> <span class="n">sym</span><span class="o">.</span><span class="n">value_type</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="ow">or</span> <span class="n">sym</span><span class="o">.</span><span class="n">value_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">,</span> <span class="s1">&#39;Metric can only be applied to numpy arrays or lists.&#39;</span>
        <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">value_type</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">sym</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="c1"># compute normalization between 0 and 1</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">sym</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:]</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Invalid shape: </span><span class="si">{</span><span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># normalize between 0 and 1 and sum to 1</span>
            <span class="n">sym</span><span class="o">.</span><span class="n">_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">sym</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">eps</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span></div>
</div>



<div class="viewcode-block" id="Style">
<a class="viewcode-back" href="../../symai.html#symai.components.Style">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Style</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">libraries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">libraries</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">libraries</span>

<div class="viewcode-block" id="Style.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Style.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">style</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">description</span><span class="p">,</span> <span class="n">libraries</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">libraries</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Query">
<a class="viewcode-back" href="../../symai.html#symai.components.Query">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Query</span><span class="p">(</span><span class="n">TrackerTraceable</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">prompt</span>

<div class="viewcode-block" id="Query.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Query.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">context</span><span class="p">:</span> <span class="n">Symbol</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Outline">
<a class="viewcode-back" href="../../symai.html#symai.components.Outline">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Outline</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="Outline.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Outline.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">outline</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Clean">
<a class="viewcode-back" href="../../symai.html#symai.components.Clean">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Clean</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="Clean.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Clean.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">clean</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Execute">
<a class="viewcode-back" href="../../symai.html#symai.components.Execute">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Execute</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">enclosure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enclosure</span> <span class="o">=</span> <span class="n">enclosure</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">template</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;# -*- code execution template -*-</span>
<span class="s2">def _func(*args, **kwargs):</span>
<span class="s2">    _value_obj_ = None</span>
<span class="si">{sym}</span>
<span class="s2">    # assume that code assigns to _value_obj_ variable</span>
<span class="s2">    return _value_obj_</span>
<span class="s2">_output_ = _func()</span>
<span class="s2">&quot;&quot;&quot;</span>

<div class="viewcode-block" id="Execute.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Execute.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="n">enclosure</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">enclosure</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">enclosure</span><span class="p">:</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;    &#39;</span> <span class="o">+</span> <span class="n">line</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">]</span>
            <span class="n">sym</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
            <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">template</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{sym}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Convert">
<a class="viewcode-back" href="../../symai.html#symai.components.Convert">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Convert</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">format</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;Python&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format</span> <span class="o">=</span> <span class="nb">format</span>

<div class="viewcode-block" id="Convert.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Convert.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">convert</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">format</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Embed">
<a class="viewcode-back" href="../../symai.html#symai.components.Embed">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Embed</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="Embed.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Embed.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Cluster">
<a class="viewcode-back" href="../../symai.html#symai.components.Cluster">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Cluster</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="Cluster.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Cluster.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Compose">
<a class="viewcode-back" href="../../symai.html#symai.components.Compose">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Compose</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="Compose.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Compose.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">compose</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Map">
<a class="viewcode-back" href="../../symai.html#symai.components.Map">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="Map.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Map.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Translate">
<a class="viewcode-back" href="../../symai.html#symai.components.Translate">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Translate</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">language</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;English&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">language</span> <span class="o">=</span> <span class="n">language</span>

<div class="viewcode-block" id="Translate.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Translate.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">sym</span><span class="o">.</span><span class="n">isinstanceof</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="si">}</span><span class="s1"> text&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">sym</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">translate</span><span class="p">(</span><span class="n">language</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">language</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="IncludeFilter">
<a class="viewcode-back" href="../../symai.html#symai.components.IncludeFilter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">IncludeFilter</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">include</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">include</span> <span class="o">=</span> <span class="n">include</span>

<div class="viewcode-block" id="IncludeFilter.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.IncludeFilter.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">include</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ExcludeFilter">
<a class="viewcode-back" href="../../symai.html#symai.components.ExcludeFilter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ExcludeFilter</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">exclude</span> <span class="o">=</span> <span class="n">exclude</span>

<div class="viewcode-block" id="ExcludeFilter.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.ExcludeFilter.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">sym</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">exclude</span><span class="p">,</span> <span class="n">include</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="FileWriter">
<a class="viewcode-back" href="../../symai.html#symai.components.FileWriter">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FileWriter</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>

<div class="viewcode-block" id="FileWriter.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.FileWriter.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">sym</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="FileReader">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FileReader</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<div class="viewcode-block" id="FileReader.exists">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader.exists">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># remove slicing if any</span>
        <span class="n">_tmp</span>     <span class="o">=</span> <span class="n">path</span>
        <span class="n">_splits</span>  <span class="o">=</span> <span class="n">_tmp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;[&#39;</span> <span class="ow">in</span> <span class="n">_tmp</span><span class="p">:</span>
            <span class="n">_tmp</span> <span class="o">=</span> <span class="n">_splits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">_splits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">_splits</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Invalid file link format.&#39;</span>
        <span class="n">_tmp</span>     <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">_tmp</span><span class="p">)</span>
        <span class="c1"># check if file exists and is a file</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">_tmp</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">_tmp</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="FileReader.get_files">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader.get_files">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_files</span><span class="p">(</span><span class="n">folder_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">accepted_formats</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.pdf&#39;</span><span class="p">,</span> <span class="s1">&#39;.md&#39;</span><span class="p">,</span> <span class="s1">&#39;.txt&#39;</span><span class="p">]</span>

        <span class="n">folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folder_path</span><span class="p">)</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">folder</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">file_path</span><span class="o">.</span><span class="n">is_file</span><span class="p">()</span> <span class="ow">and</span> <span class="n">file_path</span><span class="o">.</span><span class="n">suffix</span> <span class="ow">in</span> <span class="n">accepted_formats</span><span class="p">:</span>
                <span class="n">relative_path</span> <span class="o">=</span> <span class="n">file_path</span><span class="o">.</span><span class="n">relative_to</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="n">depth</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">relative_path</span><span class="o">.</span><span class="n">parts</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">depth</span> <span class="o">&lt;=</span> <span class="n">max_depth</span><span class="p">:</span>
                    <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file_path</span><span class="o">.</span><span class="n">as_posix</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">files</span></div>


<div class="viewcode-block" id="FileReader.extract_files">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader.extract_files">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">extract_files</span><span class="p">(</span><span class="n">cmds</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
        <span class="c1"># Use the updated regular expression to match quoted and non-quoted paths</span>
        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;&#39;&#39;(?:&quot;((?:\\.|[^&quot;\\])*)&quot;|&#39;((?:\\.|[^&#39;\\])*)&#39;|`((?:\\.|[^`\\])*)`|((?:\\ |[^ ])+))&#39;&#39;&#39;</span>
        <span class="c1"># Use the regular expression to split and handle quoted and non-quoted paths</span>
        <span class="n">matches</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">cmds</span><span class="p">)</span>
        <span class="c1"># Process the matches to handle quoted paths and normal paths</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">matches</span><span class="p">:</span>
            <span class="c1"># Each match will have 4 groups due to the pattern; only one will be non-empty</span>
            <span class="n">quoted_double</span><span class="p">,</span> <span class="n">quoted_single</span><span class="p">,</span> <span class="n">quoted_backtick</span><span class="p">,</span> <span class="n">non_quoted</span> <span class="o">=</span> <span class="n">match</span>
            <span class="k">if</span> <span class="n">quoted_double</span><span class="p">:</span>
                <span class="c1"># Remove backslashes used for escaping inside double quotes</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">(.)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">quoted_double</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">FileReader</span><span class="o">.</span><span class="n">expand_user_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">quoted_single</span><span class="p">:</span>
                <span class="c1"># Remove backslashes used for escaping inside single quotes</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">(.)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">quoted_single</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">FileReader</span><span class="o">.</span><span class="n">expand_user_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">quoted_backtick</span><span class="p">:</span>
                <span class="c1"># Remove backslashes used for escaping inside backticks</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">(.)&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="p">,</span> <span class="n">quoted_backtick</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">FileReader</span><span class="o">.</span><span class="n">expand_user_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">non_quoted</span><span class="p">:</span>
                <span class="c1"># Replace escaped spaces with actual spaces</span>
                <span class="n">path</span> <span class="o">=</span> <span class="n">non_quoted</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">file</span> <span class="o">=</span> <span class="n">FileReader</span><span class="o">.</span><span class="n">expand_user_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
                <span class="n">files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="c1"># Filter out any files that do not exist</span>
        <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span> <span class="k">if</span> <span class="n">FileReader</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>
        <span class="k">return</span> <span class="n">files</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="kc">None</span></div>


<div class="viewcode-block" id="FileReader.expand_user_path">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader.expand_user_path">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">expand_user_path</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">Path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">as_posix</span><span class="p">()</span></div>


<div class="viewcode-block" id="FileReader.integrity_check">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader.integrity_check">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">integrity_check</span><span class="p">(</span><span class="n">files</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="n">not_skipped</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">files</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">FileReader</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file</span><span class="p">):</span>
                <span class="n">not_skipped</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">CustomUserWarning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping file: </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">not_skipped</span></div>


<div class="viewcode-block" id="FileReader.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.FileReader.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">files</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">files</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Convert to list for uniform processing; more easily downstream</span>
            <span class="n">files</span> <span class="o">=</span> <span class="p">[</span><span class="n">files</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;run_integrity_check&#39;</span><span class="p">):</span>
            <span class="n">files</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrity_check</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_return_type</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span><span class="o">.</span><span class="n">value</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">files</span><span class="p">])</span></div>
</div>


<div class="viewcode-block" id="FileQuery">
<a class="viewcode-back" href="../../symai.html#symai.components.FileQuery">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">FileQuery</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">filter</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
        <span class="n">file_open</span> <span class="o">=</span> <span class="n">FileReader</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">query_stream</span> <span class="o">=</span> <span class="n">Stream</span><span class="p">(</span><span class="n">Sequence</span><span class="p">(</span>
            <span class="n">IncludeFilter</span><span class="p">(</span><span class="nb">filter</span><span class="p">),</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file</span> <span class="o">=</span> <span class="n">file_open</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<div class="viewcode-block" id="FileQuery.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.FileQuery.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">query_stream</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">sym</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">res</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="Function">
<a class="viewcode-back" href="../../symai.html#symai.components.Function">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Function</span><span class="p">(</span><span class="n">TrackerTraceable</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span>       <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
                 <span class="n">examples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">pre_processors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PreProcessor</span><span class="p">]]</span>   <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">post_processors</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">PostProcessor</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">default</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">object</span><span class="p">]</span>       <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">constraints</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Callable</span><span class="p">]</span>     <span class="o">=</span> <span class="p">[],</span>
                 <span class="n">return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span>     <span class="o">=</span> <span class="nb">str</span><span class="p">,</span>
                 <span class="n">sym_return_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">,</span>
                 <span class="n">origin_type</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Type</span><span class="p">]</span>     <span class="o">=</span> <span class="n">Expression</span><span class="p">,</span>
                 <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">chars</span>       <span class="o">=</span> <span class="n">ascii_lowercase</span> <span class="o">+</span> <span class="n">ascii_uppercase</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>   <span class="o">=</span> <span class="s1">&#39;func_&#39;</span> <span class="o">+</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sample</span><span class="p">(</span><span class="n">chars</span><span class="p">,</span> <span class="mi">15</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span>   <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span> <span class="o">=</span> <span class="n">kwargs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_promptTemplate</span>     <span class="o">=</span> <span class="n">prompt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatArgs</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatKwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">examples</span>        <span class="o">=</span> <span class="n">Prompt</span><span class="p">(</span><span class="n">examples</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_processors</span>  <span class="o">=</span> <span class="n">pre_processors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_processors</span> <span class="o">=</span> <span class="n">post_processors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span>     <span class="o">=</span> <span class="n">constraints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">default</span>         <span class="o">=</span> <span class="n">default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span>     <span class="o">=</span> <span class="n">return_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sym_return_type</span> <span class="o">=</span> <span class="n">sym_return_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">origin_type</span>     <span class="o">=</span> <span class="n">origin_type</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># return a copy of the prompt template</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatArgs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatKwargs</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_promptTemplate</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_promptTemplate</span><span class="si">}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatArgs</span><span class="p">,</span>
                                                <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatKwargs</span><span class="p">)</span>

<div class="viewcode-block" id="Function.format">
<a class="viewcode-back" href="../../symai.html#symai.components.Function.format">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatArgs</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_promptFormatKwargs</span> <span class="o">=</span> <span class="n">kwargs</span></div>


<div class="viewcode-block" id="Function.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Function.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Expression</span><span class="p">:</span>
        <span class="c1"># special case for few shot function prompt definition override</span>
        <span class="k">if</span> <span class="s1">&#39;fn&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prompt</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fn&#39;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fn&#39;</span><span class="p">]</span>
        <span class="nd">@core</span><span class="o">.</span><span class="n">few_shot</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">prompt</span><span class="p">,</span>
                  <span class="n">examples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">examples</span><span class="p">,</span>
                  <span class="n">pre_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">pre_processors</span><span class="p">,</span>
                  <span class="n">post_processors</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">post_processors</span><span class="p">,</span>
                  <span class="n">constraints</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">constraints</span><span class="p">,</span>
                  <span class="n">default</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">default</span><span class="p">,</span>
                  <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">_type</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">origin_type</span><span class="p">,</span> <span class="p">),</span> <span class="p">{</span>
            <span class="c1"># constructor</span>
            <span class="s2">&quot;forward&quot;</span><span class="p">:</span> <span class="n">_func</span><span class="p">,</span>
            <span class="s2">&quot;sym_return_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">sym_return_type</span><span class="p">,</span>
            <span class="s2">&quot;static_context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_context</span><span class="p">,</span>
            <span class="s2">&quot;dynamic_context&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynamic_context</span><span class="p">,</span>
            <span class="s2">&quot;__class__&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span>
            <span class="s2">&quot;__module__&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__module__</span><span class="p">,</span>
        <span class="p">})</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">_type</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">obj</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="PrepareData">
<a class="viewcode-back" href="../../symai.html#symai.components.PrepareData">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PrepareData</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
<div class="viewcode-block" id="PrepareData.PrepareDataPreProcessor">
<a class="viewcode-back" href="../../symai.html#symai.components.PrepareData.PrepareDataPreProcessor">[docs]</a>
    <span class="k">class</span><span class="w"> </span><span class="nc">PrepareDataPreProcessor</span><span class="p">(</span><span class="n">PreProcessor</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">argument</span><span class="p">):</span>
            <span class="k">assert</span> <span class="n">argument</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">context</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
            <span class="n">instruct</span> <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">prompt</span>
            <span class="n">context</span>  <span class="o">=</span> <span class="n">argument</span><span class="o">.</span><span class="n">prop</span><span class="o">.</span><span class="n">context</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;&quot;{</span>
<span class="s2">    &#39;context&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;,</span>
<span class="s2">    &#39;instruction&#39;: &#39;</span><span class="si">%s</span><span class="s2">&#39;,</span>
<span class="s2">    &#39;result&#39;: &#39;TODO: Replace this with the expected result.&#39;</span>
<span class="s2">}&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">context</span><span class="p">,</span> <span class="n">instruct</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pre_processors</span>  <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">PrepareDataPreProcessor</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">constraints</span>     <span class="o">=</span> <span class="p">[</span><span class="n">DictFormatConstraint</span><span class="p">({</span> <span class="s1">&#39;result&#39;</span><span class="p">:</span> <span class="s1">&#39;&lt;the data&gt;&#39;</span> <span class="p">})]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post_processors</span> <span class="o">=</span> <span class="p">[</span><span class="n">JsonTruncateMarkdownPostProcessor</span><span class="p">()]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">return_type</span>     <span class="o">=</span> <span class="nb">dict</span> <span class="c1"># constraint to cast the result to a dict</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">static_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;[CONTEXT]</span>
<span class="s2">Your goal is to prepare the data for the next task instruction. The data should follow the format of the task description based on the given context. Replace the `TODO` section with the expected result of the data preparation. Only provide the &#39;result&#39; json-key as follows: ```json</span><span class="se">\n</span><span class="s2">{ &#39;result&#39;: &#39;TODO:...&#39; }</span><span class="se">\n</span><span class="s2">```</span>

<span class="s2">[GENERAL TEMPLATE]</span>
<span class="s2">```json</span>
<span class="s2">{</span>
<span class="s2">    &#39;context&#39;: &#39;The general context of the task.&#39;,</span>
<span class="s2">    &#39;instruction&#39;: &#39;The next instruction of the task for the data preparation.&#39;,</span>
<span class="s2">    &#39;result&#39;: &#39;The expected result of the data preparation.&#39;</span>
<span class="s2">}</span>
<span class="s2">```</span>

<span class="s2">[EXAMPLE]</span>
<span class="s2">[Instruction]:</span>
<span class="s2">{</span>
<span class="s2">    &#39;context&#39;: &#39;Write a document about the history of AI and include references to the following people: Alan Turing, John McCarthy, Marvin Minsky, and Yoshua Bengio.&#39;,</span>
<span class="s2">    &#39;instruction&#39;: &#39;Google the history of AI for Alan Turing&#39;,</span>
<span class="s2">    &#39;result&#39;: &#39;TODO&#39;</span>
<span class="s2">}</span>

<span class="s2">[Result]:</span>
<span class="s2">```json</span>
<span class="s2">{</span>
<span class="s2">    &#39;result&#39;: &#39;Alan Turing history of AI&#39;</span>
<span class="s2">}</span>
<span class="s2">```</span>
<span class="s2">&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="ExpressionBuilder">
<a class="viewcode-back" href="../../symai.html#symai.components.ExpressionBuilder">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">ExpressionBuilder</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="s1">&#39;Generate the code following the instructions:&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processors</span> <span class="o">=</span> <span class="n">ProcessorPipeline</span><span class="p">([</span><span class="n">StripPostProcessor</span><span class="p">(),</span> <span class="n">CodeExtractPostProcessor</span><span class="p">()])</span>

<div class="viewcode-block" id="ExpressionBuilder.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.ExpressionBuilder.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">instruct</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">instruct</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">processors</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span></div>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">static_context</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;&quot;&quot;[Description]</span>
<span class="s2">Your goal is to generate the code of the forward function following the instruction of the extracted task and task description. Expect that all imports are already defined. Only produce the code for the TODO section as shown below:</span>

<span class="s2">[Template]</span>
<span class="s2">```python</span>
<span class="s2"># do not remove or change the imports</span>
<span class="s2">from symai import Function, Expression, Symbol</span>
<span class="s2">class TODOExpression(Expression):</span>
<span class="s2">    # initialize the expression with task specific arguments</span>
<span class="s2">    def __init__(self, *args, **kwargs):</span>
<span class="s2">        super().__init__(**kwargs)</span>
<span class="s2">        # TODO: Place here the generated code.</span>

<span class="s2">    # define the forward function with data specific arguments</span>
<span class="s2">    def forward(self, sym: Symbol, *args, **kwargs) -&gt; Symbol:</span>
<span class="s2">        sym = self._to_symbol(sym) # ensure that sym is a Symbol</span>
<span class="s2">        result = None</span>
<span class="s2">        # TODO: Place here the generated code.</span>
<span class="s2">        return result</span>
<span class="s2"># assign the expression type to the variable _value_obj_</span>
<span class="s2">_value_obj_ = TODOExpression</span>
<span class="s2">```</span>

<span class="s2">[API and Capabilities]</span>
<span class="s2">Function: Define a function with a task description.</span>
<span class="s2">func = Function(&#39;task description&#39;) # example: Function(&#39;Extract city names from the weather report.&#39;)</span>
<span class="s2">res  = func(&#39;data&#39;) # example: func(&#39;The weather in New York is 20 degrees.&#39;)</span>
<span class="s2">res # str containing the result of the function i.e. &#39;New York&#39;</span>
<span class="s2">Symbol: Define a symbol object that can be used to hold data.</span>
<span class="s2">sym  = Symbol(&#39;data&#39;) # example: Symbol(&#39;The weather in New York is 20 degrees.&#39;)</span>
<span class="s2">sym.value # value type containing the data i.e. &#39;The weather in New York is 20 degrees.&#39;</span>
<span class="s2">Expression: Define a custom expression that can be used to define a new task.</span>
<span class="s2">expr = Expression() # example: Expression() that has a __init__ and forward function.</span>
<span class="s2">res  = expr(sym) # example: expr(sym) where sym is a Symbol object.</span>

<span class="s2">Always produce the entire code to be executed in the same Python process. All task expressions and functions are defined in the same process. Generate the code within the ```python # TODO: ``` code block as shown in the example. The code must be self-contained, include all imports and executable. Do NOT remove or change the template code or the imports. Only replace the parts with TODO in the respective section and expression name with your generated code.</span>
<span class="s2">&quot;&quot;&quot;</span></div>



<div class="viewcode-block" id="JsonParser">
<a class="viewcode-back" href="../../symai.html#symai.components.JsonParser">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">JsonParser</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">json_</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">func</span> <span class="o">=</span> <span class="n">Function</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="n">JsonPromptTemplate</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">json_</span><span class="p">),</span>
                        <span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">DictFormatConstraint</span><span class="p">(</span><span class="n">json_</span><span class="p">)],</span>
                        <span class="n">pre_processors</span><span class="o">=</span><span class="p">[</span><span class="n">JsonPreProcessor</span><span class="p">()],</span>
                        <span class="n">post_processors</span><span class="o">=</span><span class="p">[</span><span class="n">JsonTruncatePostProcessor</span><span class="p">()])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fn</span> <span class="o">=</span> <span class="n">Try</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">retries</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="JsonParser.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.JsonParser.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">sym</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">sym</span><span class="p">)</span>
        <span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fn</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">ast</span><span class="p">())</span></div>
</div>



<div class="viewcode-block" id="SimilarityClassification">
<a class="viewcode-back" href="../../symai.html#symai.components.SimilarityClassification">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SimilarityClassification</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">classes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="n">in_memory</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">classes</span>   <span class="o">=</span> <span class="n">classes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric</span>    <span class="o">=</span> <span class="n">metric</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">in_memory</span> <span class="o">=</span> <span class="n">in_memory</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">in_memory</span><span class="p">:</span>
            <span class="n">CustomUserWarning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Caching mode is enabled! It is your responsability to empty the .cache folder if you did changes to the classes. The cache is located at </span><span class="si">{</span><span class="n">HOME_PATH</span><span class="si">}</span><span class="s1">/cache&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="SimilarityClassification.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.SimilarityClassification.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">x</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">usr_embed</span>    <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span>
        <span class="n">embeddings</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dynamic_cache</span><span class="p">()</span>
        <span class="n">similarities</span> <span class="o">=</span> <span class="p">[</span><span class="n">usr_embed</span><span class="o">.</span><span class="n">similarity</span><span class="p">(</span><span class="n">emb</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">metric</span><span class="p">)</span> <span class="k">for</span> <span class="n">emb</span> <span class="ow">in</span> <span class="n">embeddings</span><span class="p">]</span>
        <span class="n">similarities</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">,</span> <span class="n">similarities</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">similarities</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_dynamic_cache</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nd">@core_ext</span><span class="o">.</span><span class="n">cache</span><span class="p">(</span><span class="n">in_memory</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">in_memory</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">embed_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="n">Symbol</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">classes</span><span class="p">)</span>
            <span class="n">embeddings</span> <span class="o">=</span> <span class="p">[</span><span class="n">opt</span><span class="o">.</span><span class="n">embed</span><span class="p">()</span> <span class="k">for</span> <span class="n">opt</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">embeddings</span>

        <span class="k">return</span> <span class="n">embed_classes</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>



<div class="viewcode-block" id="InContextClassification">
<a class="viewcode-back" href="../../symai.html#symai.components.InContextClassification">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">InContextClassification</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">blueprint</span><span class="p">:</span> <span class="n">Prompt</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">blueprint</span> <span class="o">=</span> <span class="n">blueprint</span>

<div class="viewcode-block" id="InContextClassification.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.InContextClassification.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="nd">@core</span><span class="o">.</span><span class="n">few_shot</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="n">x</span><span class="p">,</span>
            <span class="n">examples</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">blueprint</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">_</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">return</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">_func</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="Indexer">
<a class="viewcode-back" href="../../symai.html#symai.components.Indexer">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">Indexer</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="n">DEFAULT</span> <span class="o">=</span> <span class="s1">&#39;dataindex&#39;</span>

<div class="viewcode-block" id="Indexer.replace_special_chars">
<a class="viewcode-back" href="../../symai.html#symai.components.Indexer.replace_special_chars">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">replace_special_chars</span><span class="p">(</span><span class="n">index</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="c1"># replace special characters that are not for path</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">index</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">index</span></div>


    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">index_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">DEFAULT</span><span class="p">,</span>
            <span class="n">top_k</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
            <span class="n">formatter</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">ParagraphFormatter</span><span class="p">(),</span>
            <span class="n">auto_add</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">raw_result</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
            <span class="n">new_dim</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1536</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">index_name</span> <span class="o">=</span> <span class="n">Indexer</span><span class="o">.</span><span class="n">replace_special_chars</span><span class="p">(</span><span class="n">index_name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index_name</span> <span class="o">=</span> <span class="n">index_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">elements</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top_k</span>      <span class="o">=</span> <span class="n">top_k</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retrieval</span>  <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span>  <span class="o">=</span> <span class="n">formatter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">raw_result</span> <span class="o">=</span> <span class="n">raw_result</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">new_dim</span>    <span class="o">=</span> <span class="n">new_dim</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sym_return_type</span> <span class="o">=</span> <span class="n">Expression</span>

        <span class="c1"># append index name to indices.txt in home directory .symai folder (default)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">HOME_PATH</span> <span class="o">/</span> <span class="s1">&#39;indices.txt&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">touch</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">auto_add</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">register</span><span class="p">()</span>

<div class="viewcode-block" id="Indexer.register">
<a class="viewcode-back" href="../../symai.html#symai.components.Indexer.register">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># check if index already exists in indices.txt and append if not</span>
        <span class="n">change</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1"># filter out empty strings</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">indices</span> <span class="k">if</span> <span class="n">i</span><span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">index_name</span><span class="p">)</span>
                <span class="n">change</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">if</span> <span class="n">change</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">indices</span><span class="p">))</span></div>


<div class="viewcode-block" id="Indexer.exists">
<a class="viewcode-back" href="../../symai.html#symai.components.Indexer.exists">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">exists</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="c1"># check if index exists in home directory .symai folder (default) indices.txt</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">HOME_PATH</span> <span class="o">/</span> <span class="s1">&#39;indices.txt&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">index_name</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Indexer.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.Indexer.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Symbol</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
            <span class="n">raw_result</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Symbol</span><span class="p">:</span>
        <span class="n">that</span> <span class="o">=</span> <span class="bp">self</span>
        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">elements</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="c1"># run over the elments in batches</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">)):</span>
                <span class="n">val</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">elements</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">batch_size</span><span class="p">])</span><span class="o">.</span><span class="n">zip</span><span class="p">(</span><span class="n">new_dim</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">new_dim</span><span class="p">)</span>
                <span class="n">that</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">index_dims</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">new_dim</span><span class="p">)</span>
            <span class="c1"># we save the index</span>
            <span class="n">that</span><span class="o">.</span><span class="n">config</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">index_dims</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">new_dim</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Symbol</span><span class="p">,</span> <span class="s1">&#39;VectorDBResult&#39;</span><span class="p">]:</span>
            <span class="n">raw_result</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;raw_result&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">that</span><span class="o">.</span><span class="n">raw_result</span>
            <span class="n">query_emb</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">embed</span><span class="p">(</span><span class="n">new_dim</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">new_dim</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">that</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">index_name</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">index_name</span><span class="p">,</span> <span class="n">index_top_k</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">top_k</span><span class="p">,</span> <span class="n">ori_query</span><span class="o">=</span><span class="n">query</span><span class="p">,</span> <span class="n">index_dims</span><span class="o">=</span><span class="n">that</span><span class="o">.</span><span class="n">new_dim</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">that</span><span class="o">.</span><span class="n">retrieval</span> <span class="o">=</span> <span class="n">res</span>
            <span class="k">if</span> <span class="n">raw_result</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">res</span>
            <span class="n">rsp</span> <span class="o">=</span> <span class="n">Symbol</span><span class="p">(</span><span class="n">res</span><span class="p">)</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">prompt</span><span class="o">=</span><span class="s1">&#39;From the retrieved data, select the most relevant information.&#39;</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">query</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">rsp</span>
        <span class="k">return</span> <span class="n">_func</span></div>
</div>



<div class="viewcode-block" id="PrimitiveDisabler">
<a class="viewcode-back" href="../../symai.html#symai.components.PrimitiveDisabler">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">PrimitiveDisabler</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_primitives</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_primitives</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Avoid circular imports; import locally</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.symbol</span><span class="w"> </span><span class="kn">import</span> <span class="n">Symbol</span>

        <span class="n">frame</span> <span class="o">=</span> <span class="n">inspect</span><span class="o">.</span><span class="n">currentframe</span><span class="p">()</span>
        <span class="n">f_locals</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_back</span><span class="o">.</span><span class="n">f_locals</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">f_locals</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">Symbol</span><span class="p">)}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_extract_primitives</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_disable_primitives</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_enable_primitives</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_disable_primitives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sym_name</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">func</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primitives</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_original_primitives</span><span class="p">[</span><span class="n">sym_name</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">func</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">func</span><span class="p">)))</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">:</span> <span class="kc">None</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_enable_primitives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sym_name</span><span class="p">,</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">func</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_original_primitives</span><span class="p">[</span><span class="n">sym_name</span><span class="p">]:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">sym</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_extract_primitives</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">sym</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_symbols</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">primitive</span> <span class="ow">in</span> <span class="n">sym</span><span class="o">.</span><span class="n">_primitives</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">method</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">primitive</span><span class="p">,</span> <span class="n">predicate</span><span class="o">=</span><span class="n">inspect</span><span class="o">.</span><span class="n">isfunction</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_primitives</span> <span class="ow">or</span> <span class="n">method</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">):</span>
                        <span class="k">continue</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_primitives</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">method</span><span class="p">)</span></div>



<div class="viewcode-block" id="FunctionWithUsage">
<a class="viewcode-back" href="../../symai.html#symai.components.FunctionWithUsage">[docs]</a>
<span class="nd">@core_ext</span><span class="o">.</span><span class="n">deprecated</span><span class="p">(</span><span class="s2">&quot;Use `symai.components.MetadataTracker` instead.&quot;</span><span class="p">)</span>
<span class="k">class</span><span class="w"> </span><span class="nc">FunctionWithUsage</span><span class="p">(</span><span class="n">Function</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">missing_usage_exception</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_tokens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_tokens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tokens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">missing_usage_exception</span> <span class="o">=</span> <span class="n">missing_usage_exception</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span> <span class="o">=</span> <span class="n">verbose</span>

<div class="viewcode-block" id="FunctionWithUsage.print_verbose">
<a class="viewcode-back" href="../../symai.html#symai.components.FunctionWithUsage.print_verbose">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">print_verbose</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span></div>


    <span class="k">def</span><span class="w"> </span><span class="nf">_format_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prompt_tokens</span><span class="p">,</span> <span class="n">completion_tokens</span><span class="p">,</span> <span class="n">total_tokens</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Box</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">:</span> <span class="n">prompt_tokens</span><span class="p">,</span>
                <span class="s2">&quot;completion_tokens&quot;</span><span class="p">:</span> <span class="n">completion_tokens</span><span class="p">,</span>
                <span class="s2">&quot;total_tokens&quot;</span><span class="p">:</span> <span class="n">total_tokens</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span>

<div class="viewcode-block" id="FunctionWithUsage.reset_usage">
<a class="viewcode-back" href="../../symai.html#symai.components.FunctionWithUsage.reset_usage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">reset_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_tokens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_tokens</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tokens</span> <span class="o">=</span> <span class="mi">0</span></div>


<div class="viewcode-block" id="FunctionWithUsage.add_usage">
<a class="viewcode-back" href="../../symai.html#symai.components.FunctionWithUsage.add_usage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">add_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">usage</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prompt_tokens</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">completion_tokens</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">total_tokens</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span></div>


<div class="viewcode-block" id="FunctionWithUsage.get_usage">
<a class="viewcode-back" href="../../symai.html#symai.components.FunctionWithUsage.get_usage">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_usage</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prompt_tokens</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">completion_tokens</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_tokens</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="FunctionWithUsage.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.FunctionWithUsage.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="s2">&quot;return_metadata&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;return_metadata&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="n">res</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">raw_output</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;raw_output&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">raw_output</span><span class="p">,</span> <span class="s2">&quot;usage&quot;</span><span class="p">):</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">raw_output</span><span class="o">.</span><span class="n">usage</span>
            <span class="n">prompt_tokens</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="s2">&quot;prompt_tokens&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">completion_tokens</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="s2">&quot;completion_tokens&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>
            <span class="p">)</span>
            <span class="n">total_tokens</span> <span class="o">=</span> <span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span> <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">usage</span><span class="p">,</span> <span class="s2">&quot;total_tokens&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">print_verbose</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;[Usage] Prompt: </span><span class="si">{</span><span class="n">prompt_tokens</span><span class="si">}</span><span class="s2"> Completion: </span><span class="si">{</span><span class="n">completion_tokens</span><span class="si">}</span><span class="s2"> Total: </span><span class="si">{</span><span class="n">total_tokens</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

            <span class="c1"># keep running total</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prompt_tokens</span> <span class="o">+=</span> <span class="n">prompt_tokens</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">completion_tokens</span> <span class="o">+=</span> <span class="n">completion_tokens</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">total_tokens</span> <span class="o">+=</span> <span class="n">total_tokens</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">missing_usage_exception</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s2">&quot;preview&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Missing usage in metadata of neursymbolic engine&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">prompt_tokens</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">completion_tokens</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">total_tokens</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_format_usage</span><span class="p">(</span><span class="n">prompt_tokens</span><span class="p">,</span> <span class="n">completion_tokens</span><span class="p">,</span> <span class="n">total_tokens</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="SelfPrompt">
<a class="viewcode-back" href="../../symai.html#symai.components.SelfPrompt">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">SelfPrompt</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="n">_default_retry_tries</span>     <span class="o">=</span> <span class="mi">20</span>
    <span class="n">_default_retry_delay</span>     <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">_default_retry_max_delay</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">_default_retry_backoff</span>   <span class="o">=</span> <span class="mi">1</span>
    <span class="n">_default_retry_jitter</span>    <span class="o">=</span> <span class="mi">0</span>
    <span class="n">_default_retry_graceful</span>  <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<div class="viewcode-block" id="SelfPrompt.forward">
<a class="viewcode-back" href="../../symai.html#symai.components.SelfPrompt.forward">[docs]</a>
    <span class="k">def</span><span class="w"> </span><span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">existing_prompt</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate new system and user prompts based on the existing prompt.</span>

<span class="sd">        :param existing_prompt: A dictionary containing the existing prompt in the format:</span>
<span class="sd">                                {&#39;user&#39;: &#39;...&#39;, &#39;system&#39;: &#39;...&#39;}</span>
<span class="sd">        :return: A dictionary containing the new prompts in the same format:</span>
<span class="sd">                 {&#39;user&#39;: &#39;...&#39;, &#39;system&#39;: &#39;...&#39;}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tries</span>     <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;tries&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_retry_tries</span><span class="p">)</span>
        <span class="n">delay</span>     <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;delay&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_retry_delay</span><span class="p">)</span>
        <span class="n">max_delay</span> <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;max_delay&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_retry_max_delay</span><span class="p">)</span>
        <span class="n">backoff</span>   <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;backoff&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_retry_backoff</span><span class="p">)</span>
        <span class="n">jitter</span>    <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;jitter&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_retry_jitter</span><span class="p">)</span>
        <span class="n">graceful</span>  <span class="o">=</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;graceful&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_default_retry_graceful</span><span class="p">)</span>

        <span class="nd">@core_ext</span><span class="o">.</span><span class="n">retry</span><span class="p">(</span><span class="n">tries</span><span class="o">=</span><span class="n">tries</span><span class="p">,</span> <span class="n">delay</span><span class="o">=</span><span class="n">delay</span><span class="p">,</span> <span class="n">max_delay</span><span class="o">=</span><span class="n">max_delay</span><span class="p">,</span> <span class="n">backoff</span><span class="o">=</span><span class="n">backoff</span><span class="p">,</span> <span class="n">jitter</span><span class="o">=</span><span class="n">jitter</span><span class="p">,</span> <span class="n">graceful</span><span class="o">=</span><span class="n">graceful</span><span class="p">)</span>
        <span class="nd">@core</span><span class="o">.</span><span class="n">zero_shot</span><span class="p">(</span>
            <span class="n">prompt</span><span class="o">=</span><span class="p">(</span>
                <span class="s2">&quot;Based on the following prompt, generate a new system (or developer) prompt and a new user prompt. &quot;</span>
                <span class="s2">&quot;The new system or developer prompt should set up a specialized agent tailored for the user&#39;s request. &quot;</span>
                <span class="s2">&quot;If examples are provided, use them to guide the agent&#39;s behavior. &quot;</span>
                <span class="s2">&quot;The new user prompt should contain the user&#39;s requirements. &quot;</span>
                <span class="s2">&quot;Check if the input contains a &#39;system&#39; or &#39;developer&#39; key and use the same key in your output. &quot;</span>
                <span class="s2">&quot;Only output the new prompts in JSON format as shown:</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">system</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">&lt;new system prompt&gt;</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">user</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">&lt;new user prompt&gt;</span><span class="se">\&quot;</span><span class="s2">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;OR</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;{</span><span class="se">\&quot;</span><span class="s2">developer</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">&lt;new developer prompt&gt;</span><span class="se">\&quot;</span><span class="s2">, </span><span class="se">\&quot;</span><span class="s2">user</span><span class="se">\&quot;</span><span class="s2">: </span><span class="se">\&quot;</span><span class="s2">&lt;new user prompt&gt;</span><span class="se">\&quot;</span><span class="s2">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
                <span class="s2">&quot;Maintain the same key structure as in the input prompt. Do not include any additional text.&quot;</span>
            <span class="p">),</span>
            <span class="n">response_format</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;json_object&quot;</span><span class="p">},</span>
            <span class="n">post_processors</span><span class="o">=</span><span class="p">[</span>
                <span class="k">lambda</span> <span class="n">res</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">res</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sym</span><span class="p">:</span> <span class="n">Symbol</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span> <span class="k">pass</span>

        <span class="k">return</span> <span class="n">_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_symbol</span><span class="p">(</span><span class="n">existing_prompt</span><span class="p">))</span></div>
</div>



<div class="viewcode-block" id="MetadataTracker">
<a class="viewcode-back" href="../../symai.html#symai.components.MetadataTracker">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">MetadataTracker</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_trace</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">value</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;{</span><span class="se">\n\t</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="s1">&#39;, </span><span class="se">\n\t</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">&quot;: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">}&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="k">return</span> <span class="s1">&#39;[&#39;</span> <span class="o">+</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;&quot;</span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s1">&quot;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\t</span><span class="s2">    </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_lock&#39;</span><span class="p">,</span> <span class="n">Lock</span><span class="p">())</span>
        <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="c1"># Set up trace function to intercept calls</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_original_trace</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">gettrace</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trace_calls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_original_trace</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_trace_calls</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">frame</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s1">&#39;return&#39;</span> <span class="ow">and</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span> <span class="o">==</span> <span class="s1">&#39;forward&#39;</span><span class="p">:</span>
            <span class="c1"># Check if this is an engine forward call</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;self&#39;</span> <span class="ow">in</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span>
                <span class="ow">and</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">],</span> <span class="n">Engine</span><span class="p">)):</span>
                <span class="n">_</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="n">arg</span>  <span class="c1"># arg contains return value on &#39;return&#39; event</span>
                <span class="n">engine_name</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="s1">&#39;self&#39;</span><span class="p">]</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span><span class="p">,</span> <span class="n">engine_name</span><span class="p">)]</span> <span class="o">=</span> <span class="n">metadata</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trace_calls</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_accumulate_completion_token_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parses the return object and accumulates completion token details per token type&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No metadata available to generate usage details.&quot;</span><span class="p">)</span>

        <span class="n">token_details</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">engine_name</span><span class="p">),</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">engine_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;GPTXChatEngine&quot;</span><span class="p">,</span> <span class="s2">&quot;GPTXReasoningEngine&quot;</span><span class="p">):</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Engine </span><span class="si">{</span><span class="n">engine_name</span><span class="si">}</span><span class="s2"> is not supported.&quot;</span><span class="p">)</span>
                <span class="k">continue</span>
            <span class="n">usage</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s2">&quot;raw_output&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">usage</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;completion_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;prompt_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;usage&quot;</span><span class="p">][</span><span class="s2">&quot;total_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">total_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;completion_breakdown&quot;</span><span class="p">][</span><span class="s2">&quot;accepted_prediction_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens_details</span><span class="o">.</span><span class="n">accepted_prediction_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;completion_breakdown&quot;</span><span class="p">][</span><span class="s2">&quot;rejected_prediction_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens_details</span><span class="o">.</span><span class="n">rejected_prediction_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;completion_breakdown&quot;</span><span class="p">][</span><span class="s2">&quot;audio_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens_details</span><span class="o">.</span><span class="n">audio_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;completion_breakdown&quot;</span><span class="p">][</span><span class="s2">&quot;reasoning_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">completion_tokens_details</span><span class="o">.</span><span class="n">reasoning_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;prompt_breakdown&quot;</span><span class="p">][</span><span class="s2">&quot;audio_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens_details</span><span class="o">.</span><span class="n">audio_tokens</span>
            <span class="n">token_details</span><span class="p">[</span><span class="s2">&quot;prompt_breakdown&quot;</span><span class="p">][</span><span class="s2">&quot;cached_tokens&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">usage</span><span class="o">.</span><span class="n">prompt_tokens_details</span><span class="o">.</span><span class="n">cached_tokens</span>

        <span class="c1"># Convert to normal dictionary</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">token_details</span><span class="p">))</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_accumulate_metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Accumulates metadata across all tracked engine calls.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{}</span>

        <span class="c1"># Use first entry as base</span>
        <span class="n">first_key</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">))</span>
        <span class="n">accumulated</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="p">[</span><span class="n">first_key</span><span class="p">])</span>

        <span class="c1"># Skipz first entry</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">engine_name</span><span class="p">),</span> <span class="n">metadata</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">items</span><span class="p">())[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">engine_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s2">&quot;GPTXChatEngine&quot;</span><span class="p">,</span> <span class="s2">&quot;GPTXReasoningEngine&quot;</span><span class="p">):</span>
                <span class="k">continue</span>

            <span class="c1"># Accumulate time if it exists</span>
            <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">accumulated</span><span class="p">:</span>
                <span class="n">accumulated</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span>

            <span class="c1"># Handle usage stats accumulation</span>
            <span class="k">if</span> <span class="s1">&#39;raw_output&#39;</span> <span class="ow">in</span> <span class="n">metadata</span> <span class="ow">and</span> <span class="s1">&#39;raw_output&#39;</span> <span class="ow">in</span> <span class="n">accumulated</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;raw_output&#39;</span><span class="p">],</span> <span class="s1">&#39;usage&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">accumulated</span><span class="p">[</span><span class="s1">&#39;raw_output&#39;</span><span class="p">],</span> <span class="s1">&#39;usage&#39;</span><span class="p">):</span>
                    <span class="n">current_usage</span> <span class="o">=</span> <span class="n">metadata</span><span class="p">[</span><span class="s1">&#39;raw_output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">usage</span>
                    <span class="n">accumulated_usage</span> <span class="o">=</span> <span class="n">accumulated</span><span class="p">[</span><span class="s1">&#39;raw_output&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">usage</span>

                    <span class="c1"># Accumulate token counts</span>
                    <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;completion_tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;prompt_tokens&#39;</span><span class="p">,</span> <span class="s1">&#39;total_tokens&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">current_usage</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">accumulated_usage</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                            <span class="nb">setattr</span><span class="p">(</span><span class="n">accumulated_usage</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
                                    <span class="nb">getattr</span><span class="p">(</span><span class="n">accumulated_usage</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span> <span class="o">+</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current_usage</span><span class="p">,</span> <span class="n">attr</span><span class="p">))</span>

                    <span class="c1"># Handle nested token details if they exist</span>
                    <span class="k">for</span> <span class="n">detail_attr</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;completion_tokens_details&#39;</span><span class="p">,</span> <span class="s1">&#39;prompt_tokens_details&#39;</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">current_usage</span><span class="p">,</span> <span class="n">detail_attr</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">accumulated_usage</span><span class="p">,</span> <span class="n">detail_attr</span><span class="p">):</span>
                            <span class="n">current_details</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current_usage</span><span class="p">,</span> <span class="n">detail_attr</span><span class="p">)</span>
                            <span class="n">accumulated_details</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">accumulated_usage</span><span class="p">,</span> <span class="n">detail_attr</span><span class="p">)</span>

                            <span class="c1"># Accumulate all numeric attributes in the details</span>
                            <span class="k">for</span> <span class="n">attr</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="n">current_details</span><span class="p">):</span>
                                <span class="k">if</span> <span class="ow">not</span> <span class="n">attr</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">accumulated_details</span><span class="p">,</span> <span class="n">attr</span><span class="p">):</span>
                                    <span class="n">current_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current_details</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                                    <span class="n">accumulated_val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">accumulated_details</span><span class="p">,</span> <span class="n">attr</span><span class="p">)</span>
                                    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">current_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">accumulated_val</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
                                        <span class="nb">setattr</span><span class="p">(</span><span class="n">accumulated_details</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">accumulated_val</span> <span class="o">+</span> <span class="n">current_val</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">accumulated</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata_acc</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accumulate_metadata</span><span class="p">()</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">metadata</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>

    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">usage</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accumulate_completion_token_details</span><span class="p">()</span></div>



<div class="viewcode-block" id="DynamicEngine">
<a class="viewcode-back" href="../../symai.html#symai.components.DynamicEngine">[docs]</a>
<span class="k">class</span><span class="w"> </span><span class="nc">DynamicEngine</span><span class="p">(</span><span class="n">Expression</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for dynamically switching neurosymbolic engine models.&quot;&quot;&quot;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">api_key</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">debug</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">api_key</span> <span class="o">=</span> <span class="n">api_key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entered</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine_instance</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="s1">&#39;_lock&#39;</span><span class="p">,</span> <span class="n">Lock</span><span class="p">())</span>
        <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="n">instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">instance</span><span class="o">.</span><span class="n">_metadata_id</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">return</span> <span class="n">instance</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entered</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">engine_instance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_engine_instance</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">engine_instance</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">traceback</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_entered</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_create_engine_instance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create an engine instance based on the model name.&quot;&quot;&quot;</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">.backend.engines.neurosymbolic</span><span class="w"> </span><span class="kn">import</span> <span class="n">ENGINE_MAPPING</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">engine_class</span> <span class="o">=</span> <span class="n">ENGINE_MAPPING</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">engine_class</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported model &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&#39;&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">engine_class</span><span class="p">(</span><span class="n">api_key</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">api_key</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to create engine for model &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="si">}</span><span class="s2">&#39;: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

</pre></div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Marius-Constantin Dinu
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      ¬© Copyright 2024, ExtensityAI FlexCo.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>